/*!
 * vuex-arcsecond-module-generator v0.4.0
 * (c) 2018 CeÃÅdric Foellmi
 * Released under the MIT License.
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("vue"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","vue","lodash"],n):n(e.VuexArcsecondModuleGenerator=e.VuexArcsecondModuleGenerator||{},e.Vue,e._)}(this,function(e,n,t){"use strict";n="default"in n?n.default:n,t="default"in t?t.default:t;var r="https"+"://"+"api.arcsecond.io"+"/",u=r,i=function(e,r,o){void 0===r&&(r=null),void 0===o&&(o=null);var c={_basePath:e,_singleUUID:null,_subPath:r,_parent:o,url:function(e){var n=u+c._basePath;if(c._parent&&c._parent._singleUUID&&(n+=c._parent._singleUUID+"/"),c._subPath&&(n+=c._subPath),e)if(t.isString(e))n+=e+"/";else if(t.isNumber(e))n+=e.toString()+"/";else if(t.isObject(e)){var r=0;t.forEach(e,function(e,t){n+=(0===r?"?":"&")+t+"="+e,r+=1})}return n},get:function(e){return n.http.get(c.url(e))},options:function(e){return n.http.options(c.url(e))},post:function(e){return n.http.post(c.url(),e)},put:function(e,t){return n.http.put(c.url(e),t)},delete:function(e){return n.http.delete(c.url(e))},subresource:function(e){return i(c._basePath,e,c)},addSubresource:function(e){return c[e.slice(0,-1)]=i(c._basePath,e,c),c},single:function(e){return c._singleUUID=e,c}};return c},o="tree_parent_id",c=function(e){return e.charAt(0).toUpperCase()+e.substring(1)},a=function(e){return{SUCCESS:e+"_SUCCESS",FAILURE:e+"_FAILURE",PENDING:e+"_PENDING"}},l=function(e){return{list:a(e+"_LIST_FETCH"),create:a(e+"_SINGLE_CREATE"),read:a(e+"_SINGLE_READ"),update:a(e+"_SINGLE_UPDATE"),delete:a(e+"_SINGLE_DELETE")}},f=function(e){return{list:"list"+e+"s",create:"create"+e,read:"read"+e,update:"update"+e,delete:"delete"+e}},d=function(e,n,r){var u;return!1!==(u=r(e,n))&&t.each(e,function(e){return!1===u||t.isNil(e.children)||(u=d(e.children,n,r)),u}),u},s=function(e,r,u){return{list:function(n,t,r){n[e]=t},create:function(u,i){u.__allowTree__&&u[r]?n.set(u[r],"children",t.concat(u[r].children||[],i)):u[e]=t.concat(u[e],i)},read:function(n,i,o){if(n.__allowTree__&&n[r])d(n[e],i[u],function(r,o){var c=t.findIndex(r,function(e){return e[u]===o});if(-1!==c)return r.splice(c,1,i),!1;n[e]=new(Function.prototype.bind.apply(Array,[null].concat(n[e])))});else{var c=t.findIndex(n[e],function(e){return e[u]===i[u]});-1!==c&&n[e].splice(c,1,i)}},update:function(i,o,c){if(i.__allowTree__)i[r]?n.set(i[r],"children",t.concat(i[r].children||[],o)):i[e]=new(Function.prototype.bind.apply(Array,[null].concat(i[e])));else{var a=t.findIndex(i[e],function(e){return e[u]===o[u]});-1!==a&&i[e].splice(a,1,o)}},delete:function(n,r,i){n.__allowTree__?(d(n[e],r[u],function(e,n){var r=t.findIndex(e,function(e){return e[u]===n});if(-1!==r)return e.splice(r,1),!1}),n[e]=new(Function.prototype.bind.apply(Array,[null].concat(n[e])))):n[e]=n[e].filter(function(e){return e[u]!==r})}}},p=function(e,n,r){return{list:function(n){return e.get(n)},create:function(n){return t.isNil(n[o])?e.post(n):e.subresource(n[o].toString()+"/").post(n[r])},read:function(n){return e.get(n.toString())},update:function(t){return e.put(t[n].toString(),t[r])},delete:function(n){return e.delete(n.toString())}}};function _(e,n,r,u,i){var o=r.toLowerCase(),a=c(o),d=o+"s",_=o+"Crud",h="selected"+a+"s",E=l(d.toUpperCase()),S=s(d,h,u),I="select"+a,v="clear"+a+"sSelection",b="update"+a+"sList",U=["list","create","read","update","delete"],g=f(a),A=p(n,u,"data"),N={},y={},P={},m={};return N.__allowTree__=e,N[d]=[],N[_]=t.zipObject(U,[!1,!1,null,null,null]),N[h]=[],y.isSelected=function(e){return function(n){return-1!==t.findIndex(e[h],function(e){return e===n})}},t.forEach(U.filter(function(e){return i.includes(e.charAt(0))}),function(e){var n,r=["list","create"];t.merge(P,((n={})[E[e].PENDING]=function(n,t){n[_][e]=!!r.includes(e)||t},n[E[e].SUCCESS]=function(n,t,u){S[e](n,t,u),n[_][e]=!r.includes(e)&&null},n[E[e].FAILURE]=function(n){n[_][e]=!r.includes(e)&&null},n))}),P[I]=function(e,n){n&&(-1===t.findIndex(e[h],function(e){return e===n})&&(e[h]=t.concat(e[h],n)))},P["de"+I]=function(e,n){if(n){var r=t.findIndex(e[h],function(e){return e===n});-1!==r&&e[h].splice(r,1)}},P[v]=function(e){e[h]=[]},P[b]=function(e,n){e[d]=n},t.forEach(U,function(e){i.includes(e.charAt(0))&&(m[g[e]]=function(n,t){var r=n.commit;return new Promise(function(n,u){r(E[e].PENDING,t),A[e](t).then(function(u){var i=u.body||u.data;r(E[e].SUCCESS,i,t),n(i)},function(n){r(E[e].FAILURE,n),u(n)})})})}),{namespaced:!0,state:N,getters:y,mutations:P,actions:m}}e.makeResource=i,e.TREE_PARENT_ID=o,e.createAsyncMutation=a,e.createMutationNames=l,e.makeListModule=function(e,n,t,r){return void 0===r&&(r="lcrud"),_(!1,e,n,t,r)},e.makeTreeModule=function(e,n,t,r){return void 0===r&&(r="lcrud"),_(!0,e,n,t,r)},e.makeModule=_,Object.defineProperty(e,"__esModule",{value:!0})});